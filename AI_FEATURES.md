# 🤖 AI 功能完整指南

## ✨ 功能概览

Huaan Command 现在集成了强大的 AI 助手功能，帮助你更高效地管理任务和解决问题。

### 核心功能

1. **AI 命令生成器** - 自然语言生成 Shell 命令
2. **AI 错误诊断** - 智能分析和解决任务错误
3. **AI 聊天助手** - 随时解答技术问题
4. **智能工作流推荐** - 基于项目自动推荐
5. **日志智能分析** - 提取关键信息和优化建议

---

## 🚀 快速开始

### 1. 配置 API Key

1. 点击右上角 **⚙️ 设置**
2. 找到 **🤖 AI 助手** 部分
3. 启用 AI 功能
4. 输入你的 OpenAI API Key（从 [platform.openai.com](https://platform.openai.com) 获取）
5. （可选）自定义 API 端点和模型
6. 点击 **🧪 测试 AI 连接** 验证配置

### 2. 开始使用

配置完成后，你可以：
- ✨ 在创建任务时使用 AI 生成命令
- 🔍 在任务详情中诊断错误
- 💬 打开 AI 聊天助手随时提问

---

## 📖 详细功能说明

### 1️⃣ AI 命令生成器

**位置**: 新建/编辑任务表单

**使用方法**:
1. 点击"命令"输入框旁的 **✨ AI 生成** 按钮
2. 用自然语言描述你想做什么
3. 按 Enter 或点击"生成"
4. AI 会返回对应的 Shell 命令
5. 点击"使用此命令"自动填充

**示例**:
- "列出所有 Docker 容器" → `docker ps -a`
- "查找大于 100MB 的文件" → `find . -size +100M -type f`
- "删除所有 node_modules" → `find . -name "node_modules" -type d -exec rm -rf {} +`

**特点**:
- 智能理解需求
- 安全命令优先
- 支持复杂操作

---

### 2️⃣ AI 错误诊断

**位置**: 任务详情页面（失败任务）

**使用方法**:
1. 打开失败的任务详情
2. 点击 **🔍 AI 诊断** 按钮
3. AI 会分析错误输出
4. 给出问题原因和多个解决方案
5. 提供相关技术背景

**输出包含**:
- 🔍 问题诊断（错误类型、根本原因）
- 💡 解决方案（推荐方案、备选方案）
- 📚 相关知识（技术背景说明）

**适用场景**:
- 编译错误
- 依赖问题
- 权限问题
- 网络错误
- 配置错误

---

### 3️⃣ AI 聊天助手

**位置**: 右侧边栏（点击 🤖 按钮）

**使用方法**:
1. 点击顶部工具栏的 **🤖** 按钮
2. 在聊天框输入问题
3. 按 Enter 发送
4. AI 会保留最近 10 条对话上下文

**快捷问题**:
首次打开时会显示几个常见问题，点击即可快速提问。

**功能特点**:
- 支持代码高亮（用 ``` 包裹代码）
- 支持 Markdown 格式
- 历史对话记忆
- 清空对话功能

**典型用途**:
- "如何查看端口占用？"
- "推荐一个部署流程"
- "git 分支管理最佳实践"
- "如何优化 Docker 镜像大小？"

---

### 4️⃣ 智能工作流推荐

**位置**: API 功能（后续可在工作流选择器中集成）

**功能**:
- 自动检测项目类型（Node.js、Python、Docker 等）
- 推荐最适合的工作流模板
- 包含常用任务和最佳实践

**推荐内容**:
- 工作流名称和描述
- 具体任务列表
- 推荐理由

---

### 5️⃣ 日志智能分析

**位置**: 任务详情（输出日志）

**功能**:
- 自动分析任务输出日志
- 提取成功/警告/错误统计
- 识别关键发现
- 给出优化建议

**输出包含**:
- 📊 执行摘要（成功、警告、错误、耗时）
- 🔍 关键发现（最重要的信息）
- 💡 优化建议（性能、配置等）

---

## ⚙️ 高级配置

### API 设置

| 选项 | 说明 | 默认值 |
|------|------|--------|
| API Key | OpenAI API 密钥 | 无 |
| API 端点 | 自定义 API 地址 | `https://api.openai.com/v1` |
| 模型 | 使用的 AI 模型 | `gpt-4o-mini` |

### 推荐模型

- **gpt-4o-mini**: 性价比最高，推荐日常使用
- **gpt-4o**: 更强大，适合复杂问题
- **gpt-3.5-turbo**: 最便宜，适合简单查询

### 兼容性

支持所有兼容 OpenAI API 格式的服务：
- OpenAI 官方
- Azure OpenAI
- 自托管模型（ollama + litellm）
- 其他兼容服务

---

## 📊 使用统计

在设置页面可以查看：
- 总调用次数
- 成功率
- 消耗 Tokens

**估算成本** (gpt-4o-mini):
- 输入: $0.15 / 1M tokens
- 输出: $0.60 / 1M tokens
- 平均每次调用: $0.0005 - $0.002

---

## 💡 最佳实践

### 1. 命令生成

✅ **好的描述**:
- "列出所有运行中的 Docker 容器"
- "查找 7 天前的日志文件并删除"
- "统计代码行数，排除 node_modules"

❌ **不好的描述**:
- "Docker" （太模糊）
- "找文件删掉" （不够具体）

### 2. 错误诊断

- 确保任务已运行并产生错误输出
- 错误信息越完整，诊断越准确
- 可以多次诊断，从不同角度分析

### 3. 聊天助手

- 问题要具体明确
- 可以要求给出代码示例
- 利用对话上下文追问细节

---

## 🔒 隐私和安全

### 数据处理

- API Key 仅存储在本地（LocalStorage）
- 与 OpenAI 的通信经过 HTTPS 加密
- 不会将你的数据发送到其他地方

### 建议

- 使用专门的 API Key，设置使用限额
- 定期检查 OpenAI 账单
- 敏感命令可以手动编辑后使用

---

## ❓ 常见问题

### Q: API Key 存储在哪里？
A: 本地浏览器的 LocalStorage，只在你的电脑上。

### Q: 可以使用其他 AI 服务吗？
A: 可以！只要兼容 OpenAI API 格式，修改 API 端点即可。

### Q: 生成的命令安全吗？
A: AI 会优先生成安全命令，但建议仔细检查后再执行。

### Q: 如何降低成本？
A: 
- 使用 gpt-4o-mini 模型
- 避免发送超长日志（自动截断到 5000 字符）
- 清空不需要的聊天历史

### Q: AI 无法连接？
A: 
1. 检查 API Key 是否正确
2. 检查网络连接
3. 尝试使用代理（修改 API 端点）
4. 查看浏览器控制台错误信息

---

## 🎯 使用场景

### 场景 1: 快速创建任务
不知道命令怎么写？用 AI 生成！
```
描述: "启动 nginx 容器，映射 80 端口"
AI 生成: docker run -d -p 80:80 nginx
```

### 场景 2: 诊断部署失败
部署失败不知道原因？让 AI 帮你分析！
```
错误: "EACCES: permission denied"
AI 诊断: 权限问题，需要使用 sudo 或修改文件权限
解决方案: sudo chown -R $USER:$USER .
```

### 场景 3: 学习新技术
想了解某个技术？问 AI！
```
你: "Docker Compose 和 Docker 有什么区别？"
AI: [详细解释和示例]
```

### 场景 4: 优化工作流
日志太长看不懂？让 AI 总结！
```
日志分析: ✅ 123 成功, ⚠️ 5 警告, ❌ 2 错误
关键发现: 构建时间过长，建议使用缓存
```

---

## 🚀 未来计划

- [ ] 任务执行计划智能推荐
- [ ] 基于历史的智能补全
- [ ] 多轮对话式任务创建
- [ ] AI 生成正则表达式
- [ ] 智能任务依赖分析
- [ ] 性能优化建议

---

## 📝 反馈

如有问题或建议，欢迎提交 Issue！

---

**享受 AI 赋能的任务管理体验！** 🎉

