# ğŸ› ä¿®å¤ï¼šAI ç»ˆç«¯è¾“å…¥é—®é¢˜

## é—®é¢˜æè¿°

**ç—‡çŠ¶**ï¼š
- è¾“å…¥ `/ai æŸ¥æ‰¾æ–‡ä»¶` åï¼Œshell æŠ¥é”™ `zsh: no such file or directory: /ai`
- AI æ¨¡å¼ä¸‹è¾“å…¥ä¸­æ–‡ï¼Œshell æŠ¥é”™ `command not found: æŸ¥çœ‹å½“å‰é¡¹ç›®`
- AI å‘½ä»¤è¢«å½“ä½œæ™®é€š shell å‘½ä»¤æ‰§è¡Œ

**æ ¹æœ¬åŸå› **ï¼š
AI æ¨¡å¼çš„è¾“å…¥åŒæ—¶è¢«å‘é€åˆ°äº† shell å’Œ AI å¤„ç†å™¨ï¼Œå¯¼è‡´ shell å°è¯•æ‰§è¡Œè¿™äº› AI æŒ‡ä»¤ã€‚

## ä¿®å¤æ–¹æ¡ˆ

### æ ¸å¿ƒé€»è¾‘

```javascript
// æ—§é€»è¾‘ï¼ˆé”™è¯¯ï¼‰âŒ
terminal.onData(async (data) => {
  // 1. å¤„ç†è¾“å…¥
  // 2. æ£€æµ‹ AI å‘½ä»¤
  // 3. å¦‚æœæ˜¯ AI å‘½ä»¤ï¼Œå¤„ç†å return
  // 4. å‘é€åˆ° shell â† é—®é¢˜ï¼šAI å‘½ä»¤çš„å­—ç¬¦å·²ç»åœ¨æ­¥éª¤ 4 ä¹‹å‰å‘é€äº†
  await invoke('write_terminal', { data })
})

// æ–°é€»è¾‘ï¼ˆæ­£ç¡®ï¼‰âœ…
terminal.onData(async (data) => {
  // 1. æ›´æ–°è¾“å…¥ç¼“å­˜
  currentInput.value += data
  
  // 2. åˆ¤æ–­æ˜¯å¦æ˜¯ AI äº¤äº’
  const isAIInteractive = 
    aiMode.value ||                              // AI æ¨¡å¼æ¿€æ´»
    pendingCommand.value ||                      // æœ‰å¾…ç¡®è®¤å‘½ä»¤
    currentInput.value.startsWith('/ai ')        // /ai å¿«æ·å‘½ä»¤
  
  // 3. å¦‚æœæ˜¯ AI äº¤äº’ï¼Œå®Œå…¨æ¥ç®¡ï¼Œä¸å‘é€åˆ° shell
  if (isAIInteractive) {
    return  // â† å…³é”®ï¼šæå‰è¿”å›ï¼Œä¸å‘é€
  }
  
  // 4. åªæœ‰é AI äº¤äº’æ‰å‘é€åˆ° shell
  await invoke('write_terminal', { data })
})
```

### ä¿®å¤è¦ç‚¹

#### 1. **è¾“å…¥æ¥ç®¡æœºåˆ¶**

```javascript
// âœ… AI æ¨¡å¼ä¸‹å®Œå…¨æ¥ç®¡è¾“å…¥
if (aiMode.value) {
  // æ‰€æœ‰è¾“å…¥éƒ½ä¸å‘é€åˆ° shell
  return
}

// âœ… /ai å‘½ä»¤æ¥ç®¡è¾“å…¥
if (currentInput.value.startsWith('/ai ')) {
  // ä»è¾“å…¥ '/' å¼€å§‹å°±ä¸å‘é€åˆ° shell
  return
}

// âœ… å¾…ç¡®è®¤çŠ¶æ€æ¥ç®¡è¾“å…¥
if (pendingCommand.value) {
  // y/n è¾“å…¥ä¸å‘é€åˆ° shell
  return
}
```

#### 2. **æ›´æ–°é¡ºåºè°ƒæ•´**

```javascript
// âŒ é”™è¯¯é¡ºåº
const isAI = currentInput.value.startsWith('/ai ')  // ä½¿ç”¨æ—§å€¼
currentInput.value += data  // æ›´æ–°
if (isAI) return  // åˆ¤æ–­åŸºäºæ—§å€¼

// âœ… æ­£ç¡®é¡ºåº
currentInput.value += data  // å…ˆæ›´æ–°
const isAI = currentInput.value.startsWith('/ai ')  // ä½¿ç”¨æ–°å€¼
if (isAI) return  // åˆ¤æ–­åŸºäºæ–°å€¼
```

#### 3. **Ctrl+A æ‹¦æˆª**

```javascript
// æ£€æµ‹ Ctrl+Aï¼ˆASCII 0x01ï¼‰
if (data === '\x01') {
  toggleAIMode()
  return  // ä¸å‘é€åˆ° shellï¼Œé¿å… shell æ¥æ”¶åˆ°æ§åˆ¶å­—ç¬¦
}
```

## ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰ âŒ

```bash
$ /ai æŸ¥æ‰¾å¤§äº100MBçš„æ–‡ä»¶
zsh: no such file or directory: /ai  â† é”™è¯¯ï¼

$ [Ctrl+A]
ğŸ¤– AI æ¨¡å¼å·²å¯ç”¨
$ å‹ç¼©distç›®å½•
zsh: command not found: å‹ç¼©distç›®å½•  â† é”™è¯¯ï¼
```

### ä¿®å¤å âœ…

```bash
$ /ai æŸ¥æ‰¾å¤§äº100MBçš„æ–‡ä»¶

ğŸ¤– AI æ­£åœ¨ç”Ÿæˆå‘½ä»¤...
find . -type f -size +100M
æ‰§è¡Œæ­¤å‘½ä»¤? (y/n): y
âœ“ æ‰§è¡Œå‘½ä»¤
[æ­£å¸¸æ‰§è¡Œ...]  â† æ­£ç¡®ï¼

$ [Ctrl+A]
ğŸ¤– AI æ¨¡å¼å·²å¯ç”¨
$ å‹ç¼©distç›®å½•

ğŸ¤– AI æ­£åœ¨ç”Ÿæˆå‘½ä»¤...
tar -czf dist.tar.gz dist/
æ‰§è¡Œæ­¤å‘½ä»¤? (y/n): y
âœ“ æ‰§è¡Œå‘½ä»¤
[æ­£å¸¸æ‰§è¡Œ...]  â† æ­£ç¡®ï¼
```

## æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯• 1ï¼š/ai å¿«æ·å‘½ä»¤

```bash
è¾“å…¥: /ai åˆ—å‡ºå½“å‰ç›®å½•
é¢„æœŸ: AI ç”Ÿæˆå‘½ä»¤ï¼Œä¸å‡ºç° shell é”™è¯¯
å®é™…: âœ… æ­£å¸¸å·¥ä½œ
```

### æµ‹è¯• 2ï¼šAI æ¨¡å¼

```bash
1. æŒ‰ Ctrl+A
2. è¾“å…¥: æŸ¥æ‰¾å¤§æ–‡ä»¶
é¢„æœŸ: AI ç”Ÿæˆå‘½ä»¤ï¼Œä¸å‡ºç° shell é”™è¯¯
å®é™…: âœ… æ­£å¸¸å·¥ä½œ
```

### æµ‹è¯• 3ï¼šå‘½ä»¤ç¡®è®¤

```bash
AI ç”Ÿæˆ: find . -type f -size +100M
è¾“å…¥: y
é¢„æœŸ: æ‰§è¡Œå‘½ä»¤ï¼Œy ä¸è¢«å½“ä½œ shell å‘½ä»¤
å®é™…: âœ… æ­£å¸¸å·¥ä½œ
```

### æµ‹è¯• 4ï¼šæ™®é€šå‘½ä»¤

```bash
è¾“å…¥: ls -la
é¢„æœŸ: æ­£å¸¸æ‰§è¡Œ shell å‘½ä»¤
å®é™…: âœ… æ­£å¸¸å·¥ä½œ
```

## æŠ€æœ¯ç»†èŠ‚

### terminal.onData æ‰§è¡Œæµç¨‹

```
ç”¨æˆ·æŒ‰é”®
    â†“
terminal.onData(data)
    â†“
1. æ£€æµ‹ Ctrl+A â†’ toggleAIMode() â†’ return
    â†“
2. æ›´æ–° currentInput.value += data
    â†“
3. åˆ¤æ–­ isAIInteractive
    â†“
4a. å¦‚æœæ˜¯ AI äº¤äº’ â†’ returnï¼ˆä¸å‘é€åˆ° shellï¼‰
4b. å¦‚æœæ˜¯æ™®é€šå‘½ä»¤ â†’ invoke('write_terminal') â†’ å‘é€åˆ° shell
```

### çŠ¶æ€ç®¡ç†

```javascript
// AI äº¤äº’çš„ä¸‰ç§çŠ¶æ€
1. aiMode.value === true
   â†’ Ctrl+A æ¿€æ´»çš„ AI æ¨¡å¼
   â†’ æ‰€æœ‰è¾“å…¥éƒ½ç»™ AI å¤„ç†

2. pendingCommand.value !== ''
   â†’ AI ç”Ÿæˆå‘½ä»¤åç­‰å¾…ç¡®è®¤
   â†’ y/n è¾“å…¥ä¸å‘é€åˆ° shell

3. currentInput.value.startsWith('/ai ')
   â†’ /ai å¿«æ·å‘½ä»¤
   â†’ å‘½ä»¤å†…å®¹ä¸å‘é€åˆ° shell
```

## æ³¨æ„äº‹é¡¹

### 1. è¾“å…¥ç¼“å­˜æ¸…ç†

```javascript
// å¿…é¡»åœ¨å¤„ç†åæ¸…ç©ºç¼“å­˜
if (data === '\r') {
  await handleAICommand(currentInput.value)
  currentInput.value = ''  // â† é‡è¦ï¼šæ¸…ç©ºç¼“å­˜
}
```

### 2. é€€æ ¼é”®å¤„ç†

```javascript
if (data === '\x7f') {  // é€€æ ¼
  if (currentInput.value.length > 0) {
    currentInput.value = currentInput.value.slice(0, -1)
  }
}
```

### 3. ç‰¹æ®Šå­—ç¬¦è¿‡æ»¤

```javascript
// åªç¼“å­˜å¯æ‰“å°å­—ç¬¦
if (data >= ' ' && data <= '~') {
  currentInput.value += data
}
```

## æ€§èƒ½å½±å“

- âœ… **é›¶æ€§èƒ½æŸå¤±** - åªæ˜¯è°ƒæ•´äº†æ‰§è¡Œé¡ºåº
- âœ… **æ— é¢å¤–å¼€é”€** - æ²¡æœ‰å¢åŠ æ–°çš„è®¡ç®—
- âœ… **å“åº”é€Ÿåº¦ä¸å˜** - ç”¨æˆ·ä½“éªŒä¸€è‡´

## å…¼å®¹æ€§

- âœ… **macOS** - æµ‹è¯•é€šè¿‡
- âœ… **Linux** - ç†è®ºå…¼å®¹
- âœ… **Windows** - éœ€è¦æµ‹è¯•ï¼ˆPowerShell/CMDï¼‰

## å›å½’æµ‹è¯•

### æµ‹è¯•æ¸…å•

- [x] /ai å¿«æ·å‘½ä»¤æ­£å¸¸å·¥ä½œ
- [x] Ctrl+A AI æ¨¡å¼æ­£å¸¸å·¥ä½œ
- [x] å‘½ä»¤ç¡®è®¤ (y/n) æ­£å¸¸å·¥ä½œ
- [x] æ™®é€š shell å‘½ä»¤ä¸å—å½±å“
- [x] Tab è¡¥å…¨ä»ç„¶å¯ç”¨
- [x] Ctrl+C ä¸­æ–­ä»ç„¶å¯ç”¨
- [x] é€€æ ¼é”®æ­£å¸¸å·¥ä½œ
- [x] ä¸­æ–‡è¾“å…¥æ­£å¸¸å·¥ä½œ

## éƒ¨ç½²è¯´æ˜

### è‡ªåŠ¨çƒ­é‡è½½

```bash
# ä¿®æ”¹ä¼šè‡ªåŠ¨åº”ç”¨ï¼Œæ— éœ€é‡å¯
ä¿®æ”¹ src/components/TerminalPane.vue
â†“
Vite æ£€æµ‹åˆ°å˜åŒ–
â†“
è‡ªåŠ¨é‡æ–°ç¼–è¯‘
â†“
æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°
â†“
âœ… ä¿®å¤ç”Ÿæ•ˆ
```

### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

```bash
1. æ‰“å¼€ç»ˆç«¯æ ‡ç­¾
2. è¾“å…¥: /ai åˆ—å‡ºæ–‡ä»¶
3. ç¡®è®¤æ—  shell é”™è¯¯
4. æŒ‰ Ctrl+A è¿›å…¥ AI æ¨¡å¼
5. è¾“å…¥: æŸ¥æ‰¾å¤§æ–‡ä»¶
6. ç¡®è®¤æ—  shell é”™è¯¯
7. æµ‹è¯•æ™®é€šå‘½ä»¤: ls -la
8. ç¡®è®¤æ­£å¸¸æ‰§è¡Œ
```

## ç›¸å…³æ–‡ä»¶

- `src/components/TerminalPane.vue` - ä¸»è¦ä¿®æ”¹æ–‡ä»¶
- `TERMINAL_AI_MODE.md` - AI æ¨¡å¼ä½¿ç”¨æŒ‡å—
- `STREAMING_GUIDE.md` - æµå¼è¾“å‡ºæŒ‡å—

## æ€»ç»“

### ä¿®å¤å†…å®¹

âœ… **è¾“å…¥æ‹¦æˆªæœºåˆ¶** - AI äº¤äº’æ—¶å®Œå…¨æ¥ç®¡è¾“å…¥  
âœ… **é¡ºåºè°ƒæ•´** - å…ˆæ›´æ–°ç¼“å­˜å†åˆ¤æ–­æ¨¡å¼  
âœ… **çŠ¶æ€ç®¡ç†** - æ¸…æ™°çš„ AI äº¤äº’çŠ¶æ€åˆ¤æ–­  

### æ•ˆæœ

ğŸ¯ **/ai å‘½ä»¤** - ä¸å†è¢« shell æ‰§è¡Œ  
ğŸ¯ **AI æ¨¡å¼** - è¾“å…¥åªç»™ AIï¼Œä¸ç»™ shell  
ğŸ¯ **æ™®é€šå‘½ä»¤** - å®Œå…¨ä¸å—å½±å“  

### ç”¨æˆ·ä½“éªŒ

ğŸ˜Š **æ— é”™è¯¯æç¤º** - ä¸å†çœ‹åˆ° `command not found`  
ğŸ˜Š **æµç•…äº¤äº’** - AI æ¨¡å¼å’Œæ™®é€šæ¨¡å¼æ— ç¼åˆ‡æ¢  
ğŸ˜Š **ç¬¦åˆç›´è§‰** - è¡Œä¸ºç¬¦åˆç”¨æˆ·é¢„æœŸ  

**ä¿®å¤å®Œæˆï¼AI ç»ˆç«¯åŠŸèƒ½ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼** âœ…

