# 🐛 内置调试面板使用指南

## 📋 简介

由于 Tauri 应用中不容易打开浏览器开发者工具，我为你添加了一个**内置的调试面板**，可以直接在应用界面中查看所有的控制台日志！

## 🚀 如何打开调试面板

### 方法 1: 使用快捷键（推荐）

按下 **`Ctrl+Shift+D`**（或 macOS: `Cmd+Shift+D`）

### 方法 2: 点击浮动按钮

在应用右下角会看到一个 🐛 图标的浮动按钮，点击它即可打开。

## 📊 调试面板功能

### 1. 实时日志显示

面板会捕获并显示：
- ✅ 所有 `console.log()` 消息（蓝色边框）
- ⚠️ 所有 `console.warn()` 警告（橙色边框）
- ❌ 所有 `console.error()` 错误（红色边框）

### 2. 时间戳

每条日志都带有精确的时间戳，方便追踪问题发生的时间点。

### 3. 自动滚动

新日志会自动添加到底部，并保留最近 200 条日志。

### 4. 日志管理

- **清空按钮**: 点击"清空"清除所有日志
- **关闭按钮**: 点击 ✕ 关闭面板（日志会保留）

## 🧪 测试终端初始化

现在，当你创建新终端时，调试面板会实时显示：

```
12:34:56 🟢 BlockTerminalPane 初始化开始 (会话: 1234567890, visible: true)
12:34:56 ✅ 终端容器 DOM 元素存在: [object HTMLDivElement]
12:34:56 📝 创建 xterm.js 实例
12:34:56 🔌 加载终端插件
12:34:56 📺 打开终端到 DOM
12:34:56 📏 调整终端大小
12:34:56 ✅ xterm.js 终端已创建，尺寸: 80 x 24
12:34:56 📡 开始监听终端输出: terminal-output-1234567890
12:34:56 ✅ 终端输出监听已设置
12:34:56 📤 发送初始化命令到会话: 1234567890
12:34:56 ✅ 初始化命令已发送
12:34:57 📥 收到终端输出 (会话 1234567890): ...
```

## 🔍 如何使用调试面板排查白屏问题

### 步骤 1: 打开调试面板

按 `Ctrl+Shift+D` 或点击右下角的 🐛 按钮

### 步骤 2: 创建新终端

点击 "+" 按钮创建新终端

### 步骤 3: 观察日志

查看调试面板中的日志，关注以下关键信息：

#### ✅ 正常流程应该看到：

1. `🟢 BlockTerminalPane 初始化开始` - 组件开始初始化
2. `✅ 终端容器 DOM 元素存在` - DOM 元素正常
3. `✅ xterm.js 终端已创建，尺寸: XX x YY` - 终端创建成功
4. `📡 开始监听终端输出` - 开始监听后端
5. `📤 发送初始化命令` - 发送初始化命令
6. `📥 收到终端输出` - 收到后端响应

#### ❌ 如果出现错误：

- `❌ 终端容器 DOM 元素不存在` → 前端渲染问题
- `❌ 初始化失败` → 后端通信问题
- `⚠️ 终端实例不存在，无法写入输出` → 终端对象异常

### 步骤 4: 查看终端界面

同时观察终端界面：

- **应该立即看到**："🚀 终端已就绪" 和 "等待 shell 初始化..."
- **300ms 后应该看到**: Shell prompt（如 `user@hostname:~$`）

### 步骤 5: 截图并反馈

如果问题依然存在，请提供：

1. **调试面板截图** - 显示完整的日志序列
2. **终端界面截图** - 显示是否有欢迎消息
3. **具体的错误信息** - 从调试面板中复制红色的错误日志

## 💡 常见问题

### Q: 调试面板不显示？

**A**: 确保应用已完全加载，然后按 `Ctrl+Shift+D`。如果还是不显示，检查右下角是否有 🐛 浮动按钮。

### Q: 日志太多看不清？

**A**: 点击"清空"按钮清除旧日志，然后重新执行操作。

### Q: 如何复制日志？

**A**: 目前需要手动截图或记录。日志会保留最近 200 条，可以随时查看。

### Q: 调试面板会影响性能吗？

**A**: 轻微影响，但在开发调试阶段可以忽略。最多保留 200 条日志，不会无限增长。

## 🎯 预期结果

使用调试面板后，你应该能够：

1. ✅ 清楚看到终端初始化的每一步
2. ✅ 准确定位问题发生的环节
3. ✅ 无需打开浏览器开发者工具
4. ✅ 实时查看应用运行状态

## 📸 示例截图说明

### 正常流程的日志：

```
12:00:00 🟢 BlockTerminalPane 初始化开始 (会话: xxx, visible: true)
12:00:00 ✅ 终端容器 DOM 元素存在
12:00:00 ✅ xterm.js 终端已创建，尺寸: 80 x 24
12:00:00 ✅ 终端输出监听已设置
12:00:00 ✅ 初始化命令已发送
12:00:00 📥 收到终端输出 (会话 xxx): bash-5.2$ 
```

**说明**: 这是完全正常的初始化流程，终端应该可以正常工作。

### 出现问题的日志：

```
12:00:00 🟢 BlockTerminalPane 初始化开始 (会话: xxx, visible: false)
12:00:00 ❌ 终端容器 DOM 元素不存在！
```

**说明**: 这表示组件的 visible 属性为 false 或 DOM 元素未正确渲染。

## 🔧 高级用法

### 过滤特定日志

在调试面板中，你可以：
- 蓝色边框 = 普通日志（info）
- 橙色边框 = 警告（需要注意）
- 红色边框 = 错误（优先处理）

### 追踪特定会话

每条与终端相关的日志都会包含会话 ID，例如：
```
会话 1761452981193
```

这样你可以追踪特定终端的所有操作。

---

**版本**: v1.1.0  
**创建时间**: 2025-01-26  
**状态**: ✅ 可用

## 🆘 获取帮助

如果使用调试面板后仍无法解决问题，请提供：

1. 调试面板的完整截图（包含所有日志）
2. 终端界面截图
3. 操作步骤描述

这些信息将帮助快速定位问题！

