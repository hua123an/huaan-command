# 性能分析与优化

## 🔍 当前性能问题

### 1. 前端性能瓶颈

#### 问题 1: 大量任务输出导致内存溢出
**现状**: 任务输出无限累积
**影响**: 运行长时间任务会导致浏览器卡顿甚至崩溃

#### 问题 2: 实时搜索无防抖
**现状**: 每次输入都立即过滤整个任务列表
**影响**: 任务多时会造成输入延迟

#### 问题 3: 任务列表未使用虚拟滚动
**现状**: 所有任务都渲染在 DOM 中
**影响**: 100+ 任务时滚动不流畅

#### 问题 4: watch 监听整个 tasks 数组
**现状**: 任何任务状态变化都触发保存
**影响**: 高频更新时性能下降

### 2. 后端性能瓶颈

#### 问题 1: 输出事件未节流
**现状**: 每读取一行就发送一个事件
**影响**: 大量输出时事件队列拥堵

#### 问题 2: 没有输出缓冲
**现状**: 直接累积所有输出到字符串
**影响**: 内存持续增长

#### 问题 3: 没有并发限制
**现状**: 可以同时运行无限个任务
**影响**: 系统资源耗尽

## 🚀 优化方案

### 前端优化（实施中）

1. **输出行数限制** ✅
   - 保留最后 10,000 行
   - 使用 VecDeque 循环缓冲区

2. **搜索防抖** ✅
   - 300ms 防抖延迟
   - 减少计算次数

3. **localStorage 节流保存** ✅
   - 1 秒内最多保存一次
   - 减少 I/O 操作

4. **计算属性缓存** ✅
   - filteredTasks 只在需要时计算
   - 使用 computed 自动缓存

5. **事件监听优化** ✅
   - 输出节流到 100ms
   - 批量更新 DOM

### 后端优化（实施中）

1. **输出缓冲** ✅
   - 100ms 批量发送
   - 减少事件数量

2. **输出行数限制** ✅
   - 保留最后 10,000 行
   - 防止内存溢出

3. **并发控制** ✅
   - 最大同时运行 10 个任务
   - 使用 Semaphore 限流

4. **内存优化** ✅
   - 使用 VecDeque 代替 String
   - 及时释放资源

