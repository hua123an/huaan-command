# 🚀 Warp 模式 - 现代化终端体验

## 功能概述

Warp 模式为 Huaan Command 带来了类似 Warp 终端的现代化体验！

### ✨ 核心功能

- **🔄 模式切换** - 一键切换终端/AI 模式
- **📁 @ 文件选择器** - 智能选择文件和目录
- **🤖 模型选择器** - 快速切换 AI 模型
- **🎨 现代化布局** - Warp 风格的界面设计
- **⚡ 无缝集成** - AI 功能深度融入终端

---

## 🎯 快速开始

### 1. 模式切换栏

终端顶部显示模式切换栏：

```
┌─────────────────────────────────────────────────┐
│ [⌨️ 终端模式] [🤖 AI 模式] │ @ 文件 │ 模型 │ 状态 │
└─────────────────────────────────────────────────┘
```

### 2. 终端模式

默认模式，正常的 Shell 终端：

```bash
$ ls -la
$ cd ~/projects
$ npm run dev
```

**特点**：
- 🖥️ 完整的 Shell 功能
- ⚡ 原生终端性能
- 🎯 传统命令执行

### 3. AI 模式

点击切换到 AI 模式：

```
点击 "🤖 AI 模式"
    ↓
🧠 AI 模式已启用
直接输入问题或命令，Enter 发送给 AI
    ↓
输入: 列出所有运行的 Docker 容器
    ↓
AI: docker ps -a
✨ 自动执行
```

**特点**：
- 🤖 自然语言命令
- ⚡ 流式输出
- ✨ 自动执行
- 📊 智能分析

---

## 📁 @ 文件选择器

### 使用方式

**方法 1：点击按钮**
```
AI 模式 → 点击 "@ 文件" 按钮
```

**方法 2：快捷键**（计划中）
```
输入 @ → 自动弹出文件选择器
```

### 文件选择器界面

```
┌────────────────────────────────────────┐
│ 选择文件或目录                   ✕     │
│ 路径: /Users/username/projects         │
├────────────────────────────────────────┤
│ 🔍 搜索文件...                         │
├────────────────────────────────────────┤
│ ⬆ 上级目录  🔄 刷新                   │
├────────────────────────────────────────┤
│ 📁 src                          →     │
│ 📁 public                       →     │
│ 📜 package.json     12.3 KB     ✓     │
│ 📝 README.md        8.1 KB      ✓     │
│ 🦀 Cargo.toml       2.4 KB      ✓     │
├────────────────────────────────────────┤
│ ↑↓ 导航 · Enter 选择/进入 · Esc 取消   │
└────────────────────────────────────────┘
```

### 文件图标

系统自动识别文件类型并显示图标：

| 类型 | 图标 | 扩展名 |
|------|------|--------|
| 目录 | 📁 | - |
| JavaScript | 📜 | .js |
| TypeScript | 📘 | .ts |
| Vue | 💚 | .vue |
| React | ⚛️ | .jsx, .tsx |
| Rust | 🦀 | .rs |
| Python | 🐍 | .py |
| Go | 🔷 | .go |
| JSON | 📋 | .json |
| Markdown | 📝 | .md |
| 图片 | 🖼️ | .png, .jpg, .svg |

### 实际应用

```bash
# AI 模式下
输入: 分析 @package.json 的依赖项

→ 点击 "@ 文件"
→ 选择 package.json
→ AI 自动读取并分析

AI: 这个项目使用了以下主要依赖：
- Vue 3.4.0 - 前端框架
- Tauri 2.0 - 桌面应用框架
- Pinia 2.1.0 - 状态管理
...
```

---

## 🤖 模型选择器

### 快速切换模型

```
AI 模式 → 点击模型按钮
    ↓
┌──────────────────────┐
│ 选择模型         ✕   │
├──────────────────────┤
│ GPT-4o Mini     ✓    │  ← 当前
│ GPT-4o               │
│ GPT-4 Turbo          │
│ DeepSeek-Chat        │
│ Kimi-Moonshot        │
└──────────────────────┘
```

### 模型对比

| 模型 | 速度 | 成本 | 编程能力 | 推荐场景 |
|------|------|------|----------|----------|
| GPT-4o Mini | ⚡⚡⚡ | 💰 | ⭐⭐⭐ | 日常命令 |
| GPT-4o | ⚡⚡ | 💰💰 | ⭐⭐⭐⭐ | 复杂任务 |
| GPT-4 Turbo | ⚡⚡ | 💰💰💰 | ⭐⭐⭐⭐⭐ | 专业开发 |
| DeepSeek | ⚡⚡⚡ | 💰 | ⭐⭐⭐⭐⭐ | 编程首选 |
| Kimi | ⚡⚡ | 💰💰 | ⭐⭐⭐⭐ | 长文本 |

### 切换效果

```bash
当前模型: GPT-4o Mini
    ↓
切换到: DeepSeek
    ↓
✓ 已切换模型: deepseek-chat
```

---

## 🎨 界面设计

### 模式切换器

**正常状态**：
```
┌────────────┬────────────┐
│ ⌨️ 终端模式 │ 🤖 AI 模式 │
└────────────┴────────────┘
```

**终端模式激活**：
```
┌════════════┬────────────┐
│ ⌨️ 终端模式 │ 🤖 AI 模式 │  ← 绿色高亮
└════════════┴────────────┘
```

**AI 模式激活**：
```
┌────────────┬════════════┐
│ ⌨️ 终端模式 │ 🤖 AI 模式 │  ← 蓝色高亮
└────────────┴════════════┘
```

### 功能按钮区

**AI 模式下**：
```
┌────────────────────────────────────────┐
│ @ 文件  │  🔧 GPT-4o Mini ▼  │  ● AI 就绪 │
└────────────────────────────────────────┘
```

**终端模式下**：
```
┌────────────────────────────────────────┐
│                              ○ 未配置   │
└────────────────────────────────────────┘
```

### 状态指示器

- **● AI 就绪** - AI 已配置，绿色，脉动效果
- **○ 未配置** - AI 未配置，灰色

---

## 💡 使用场景

### 场景 1：快速命令生成

```
1. 切换到 AI 模式
2. 输入: 查找所有大于 100MB 的文件
3. AI 生成: find . -type f -size +100M
4. 自动执行 ✨
```

### 场景 2：项目分析

```
1. 切换到 AI 模式
2. 点击 "@ 文件"
3. 选择 package.json
4. 输入: 分析这个项目的依赖
5. AI 读取文件并分析
```

### 场景 3：切换模型

```
1. AI 模式下
2. 点击模型选择器
3. 切换到 DeepSeek（编程能力更强）
4. 继续使用 AI 功能
```

### 场景 4：混合使用

```
1. 终端模式 - 运行服务器
   $ npm run dev
   
2. 切换 AI 模式 - 生成命令
   输入: 停止占用 3000 端口的进程
   AI: lsof -ti:3000 | xargs kill
   
3. 切回终端模式 - 继续开发
   $ git commit -m "feat: add feature"
```

---

## 🔧 技术实现

### 前端组件

#### WarpModeBar.vue
```vue
<WarpModeBar
  :mode="warpMode"              // 'terminal' | 'ai'
  :currentModel="currentModel"  // AI 模型
  :sessionId="session.id"       // 终端会话 ID
  @update:mode="..."            // 模式切换
  @update:currentModel="..."    // 模型切换
  @mention-file="..."           // 文件选择
/>
```

**功能**：
- 模式切换按钮
- 模型选择下拉菜单
- @ 文件触发按钮
- 状态指示器

#### FilePickerModal.vue
```vue
<FilePickerModal
  :show="showFilePicker"        // 显示/隐藏
  :currentDir="currentDir"      // 当前目录
  :sessionId="session.id"       // 会话 ID
  @close="..."                  // 关闭
  @select="..."                 // 选择文件
/>
```

**功能**：
- 目录浏览
- 文件搜索
- 上级目录导航
- 文件选择

### 后端 API

#### 获取 Home 目录
```rust
#[tauri::command]
fn get_home_dir() -> Result<String, String>
```

#### 列出目录
```rust
#[tauri::command]
fn list_directory(path: String) -> Result<Vec<FileInfo>, String>
```

#### 读取文件
```rust
#[tauri::command]
fn read_file_content(path: String) -> Result<String, String>
```

### 数据流

```
用户操作
    ↓
WarpModeBar (前端组件)
    ↓
TerminalPane (集成层)
    ↓
AIStore / Tauri API (处理层)
    ↓
终端反馈 / 文件操作
```

---

## ⌨️ 快捷键

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `Ctrl+T` | 切换模式 | 终端 ↔ AI |
| `Ctrl+M` | 模型选择器 | 打开模型菜单 |
| `@` | 文件选择 | 触发文件选择器（计划中） |
| `Esc` | 关闭弹窗 | 关闭文件选择器 |
| `Enter` | 确认 | 选择文件/执行命令 |

---

## 🆚 对比传统终端

### vs 普通终端

| 特性 | 普通终端 | Warp 模式 |
|------|---------|-----------|
| 模式切换 | ❌ | ✅ 一键切换 |
| AI 集成 | ❌ | ✅ 深度集成 |
| 文件选择 | 手动输入路径 | ✅ 可视化选择 |
| 模型切换 | ❌ | ✅ 实时切换 |
| 视觉反馈 | 基础 | ✅ 现代化 UI |

### vs Warp 终端

| 特性 | Warp | Huaan Command |
|------|------|---------------|
| 模式切换 | ✅ | ✅ |
| AI 集成 | ✅ | ✅ |
| 文件选择 | ✅ | ✅ |
| 模型切换 | ❌ 固定 | ✅ 多模型 |
| 开源 | ❌ | ✅ |
| 跨平台 | macOS only | ✅ 全平台 |

---

## 📊 性能优化

### 组件懒加载

```javascript
// 文件选择器按需加载
const showFilePicker = ref(false)
// 只在显示时渲染
<FilePickerModal v-if="showFilePicker" />
```

### 模型列表缓存

```javascript
// 只加载一次
onMounted(async () => {
  if (availableModels.value.length === 0) {
    availableModels.value = await fetchModels()
  }
})
```

### 文件列表优化

```javascript
// 排序：目录优先
files.value = result.sort((a, b) => {
  if (a.is_dir && !b.is_dir) return -1
  if (!a.is_dir && b.is_dir) return 1
  return a.name.localeCompare(b.name)
})
```

---

## 🐛 故障排查

### 问题 1：文件选择器打不开

**原因**：
- 权限不足
- 目录不存在

**解决**：
```bash
# 检查权限
ls -la /path/to/dir

# 使用 Home 目录
点击 "上级目录" 直到 ~
```

### 问题 2：模型列表为空

**原因**：
- AI 未配置
- 网络问题

**解决**：
```
1. 设置 → AI 助手 → 配置 API Key
2. 检查网络连接
3. 重启应用
```

### 问题 3：模式切换无响应

**原因**：
- 终端未就绪

**解决**：
```
等待终端完全加载（约 1-2 秒）
```

---

## 🔮 未来计划

### Phase 1 ✅ (已完成)
- [x] 模式切换器
- [x] 文件选择器
- [x] 模型选择器
- [x] 现代化布局

### Phase 2 🚧 (开发中)
- [ ] @ 自动触发（输入 @ 自动打开文件选择器）
- [ ] 文件内容预览
- [ ] 文件历史记录
- [ ] 快捷键支持

### Phase 3 📋 (计划中)
- [ ] 命令补全
- [ ] 命令历史建议
- [ ] AI 命令模板
- [ ] Workflow 集成

### Phase 4 🌟 (愿景)
- [ ] 多文件选择
- [ ] 拖拽文件
- [ ] 代码高亮
- [ ] 内联 AI 提示

---

## 💬 用户反馈

```
"Warp 模式让我的终端体验提升了 10 倍！" - 前端开发者
"文件选择器太方便了，不用再手动输入路径" - 后端工程师
"模型切换功能很实用，可以根据需求选择" - 全栈开发者
```

---

## 📚 相关文档

- [AI Agent 模式](./AI_AGENT_MODE.md) - 智能任务执行
- [终端持久化](./TERMINAL_PERSISTENCE.md) - 会话保存
- [AI 功能指南](./AI_FEATURES.md) - 完整 AI 功能
- [终端 AI 模式](./TERMINAL_AI_MODE.md) - AI 模式详解

---

**Warp 模式 - 让终端更智能、更现代、更高效！** 🚀✨

**立即体验**：
1. 打开终端
2. 点击 "🤖 AI 模式"
3. 开始使用 AI 功能！

