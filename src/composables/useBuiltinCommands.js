/**
 * å†…ç½®å‘½ä»¤ç³»ç»Ÿ
 * æä¾›å¿«æ·çš„ AI åŠŸèƒ½å‘½ä»¤ï¼Œä½¿ç”¨ : å‰ç¼€
 */

export function useBuiltinCommands() {
  /**
   * å†…ç½®å‘½ä»¤å®šä¹‰
   * key: å‘½ä»¤åç§°ï¼ˆåŒ…å« : å‰ç¼€ï¼‰
   * value: AI æç¤ºè¯æ¨¡æ¿æˆ–å‡½æ•°
   */
  const builtinCommands = {
    // AI åŠ©æ‰‹ä»‹ç»ï¼ˆæ—  : å‰ç¼€ï¼‰
    'claude': 'ä½ å¥½ï¼æˆ‘æ˜¯ Claudeï¼ŒAnthropic å¼€å‘çš„ AI åŠ©æ‰‹ã€‚\n\næˆ‘çš„èƒ½åŠ›ï¼š\n- ðŸ’¡ å›žç­”ç¼–ç¨‹å’ŒæŠ€æœ¯é—®é¢˜\n- ðŸ› ï¸ ç”Ÿæˆå’Œè§£é‡Šå‘½ä»¤\n- ðŸ› è¯Šæ–­å’Œä¿®å¤é”™è¯¯\n- ðŸ“š æä¾›å­¦ä¹ å»ºè®®\n- ðŸŽ¨ è¾…åŠ©åˆ›æ„å’Œå‘½å\n\nè¯•è¯•è¾“å…¥ :help æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤ï¼Œæˆ–è€…ç›´æŽ¥é—®æˆ‘é—®é¢˜ï¼',
    'kimi': 'ä½ å¥½ï¼æˆ‘æ˜¯ Kimiï¼Œæœˆä¹‹æš—é¢ç§‘æŠ€å¼€å‘çš„ AI åŠ©æ‰‹ã€‚\n\næˆ‘å¯ä»¥å¸®ä½ ï¼š\n- ðŸ”§ è§£å†³æŠ€æœ¯éš¾é¢˜\n- ðŸ“ ç”Ÿæˆå‘½ä»¤å’Œè„šæœ¬\n- ðŸ” åˆ†æžä»£ç å’Œæ—¥å¿—\n- ðŸ’¬ è¿›è¡ŒæŠ€æœ¯äº¤æµ\n- ðŸš€ æå‡å¼€å‘æ•ˆçŽ‡\n\nè¾“å…¥ :list æŸ¥çœ‹å†…ç½®å‘½ä»¤ï¼Œæˆ–ç›´æŽ¥å‘æˆ‘æé—®ï¼',
    'gpt': 'ä½ å¥½ï¼æˆ‘æ˜¯ GPTï¼ŒOpenAI å¼€å‘çš„ AI åŠ©æ‰‹ã€‚\n\næˆ‘èƒ½ä¸ºä½ ï¼š\n- âœ¨ å›žç­”å„ç±»æŠ€æœ¯é—®é¢˜\n- ðŸŽ¯ ç”Ÿæˆç²¾å‡†çš„å‘½ä»¤\n- ðŸ”§ è°ƒè¯•å’Œä¼˜åŒ–ä»£ç \n- ðŸ“– æä¾›å­¦ä¹ èµ„æº\n- ðŸŒŸ æ¿€å‘åˆ›æ„çµæ„Ÿ\n\nä½¿ç”¨ :help äº†è§£æ›´å¤šå‘½ä»¤ï¼Œæˆ–è€…éšæ—¶å‘æˆ‘æé—®ï¼',
    'deepseek': 'ä½ å¥½ï¼æˆ‘æ˜¯ DeepSeekï¼Œæ·±åº¦æ±‚ç´¢å¼€å‘çš„ AI åŠ©æ‰‹ã€‚\n\næˆ‘çš„ç‰¹é•¿ï¼š\n- ðŸ§  æ·±åº¦ç†è§£æŠ€æœ¯é—®é¢˜\n- âš¡ å¿«é€Ÿç”Ÿæˆè§£å†³æ–¹æ¡ˆ\n- ðŸ” ç²¾å‡†çš„ä»£ç åˆ†æž\n- ðŸ“š å…¨é¢çš„çŸ¥è¯†æ”¯æŒ\n- ðŸŽ“ è€å¿ƒçš„æŠ€æœ¯æŒ‡å¯¼\n\nè¾“å…¥ :help æŸ¥çœ‹å‘½ä»¤åˆ—è¡¨ï¼Œæˆ–ç›´æŽ¥å¼€å§‹å¯¹è¯ï¼',

    // å¨±ä¹ç±»
    ':joke': 'ç»™æˆ‘è®²ä¸€ä¸ªç¨‹åºå‘˜ç¬‘è¯ï¼Œè¦å¹½é»˜æœ‰è¶£',
    ':smile': 'ç»™æˆ‘ä¸€å¥åŠ±å¿—çš„è¯ï¼Œé¼“èˆžäººå¿ƒçš„é‚£ç§',
    ':quote': 'åˆ†äº«ä¸€å¥å…³äºŽç¼–ç¨‹æˆ–æŠ€æœ¯çš„åè¨€',
    ':zen': 'åˆ†äº«ä¸€å¥ç¦…æ„çš„è¯ï¼Œè®©äººå¹³é™æ€è€ƒ',

    // å®žç”¨ç±»
    ':tip': 'ç»™æˆ‘ä¸€ä¸ªç»ˆç«¯ä½¿ç”¨æŠ€å·§æˆ– shell å‘½ä»¤æŠ€å·§',
    ':debug': 'åˆ†æžç»ˆç«¯ä¸­æœ€è¿‘çš„é”™è¯¯è¾“å‡ºï¼Œç»™å‡ºè§£å†³æ–¹æ¡ˆ',
    ':explain': (args) => args ? `è¯¦ç»†è§£é‡Šè¿™ä¸ªå‘½ä»¤çš„ä½œç”¨: ${args}` : 'è¯·æä¾›éœ€è¦è§£é‡Šçš„å‘½ä»¤',
    ':how': (args) => args ? `å¦‚ä½•ä½¿ç”¨å‘½ä»¤è¡Œå®žçŽ°: ${args}` : 'è¯·æè¿°ä½ æƒ³å®žçŽ°çš„åŠŸèƒ½',

    // Git ç›¸å…³
    ':commit': 'æ ¹æ®å½“å‰çš„ä»£ç å˜æ›´ç”Ÿæˆä¸€ä¸ªå¥½çš„ git commit message',
    ':review': 'å®¡æŸ¥å½“å‰çš„ä»£ç å˜æ›´ï¼Œç»™å‡ºæ”¹è¿›å»ºè®®',
    ':branch': 'å»ºè®®ä¸€ä¸ªåˆé€‚çš„ git åˆ†æ”¯åç§°',

    // å¼€å‘ç›¸å…³
    ':doc': (args) => args ? `ä¸ºè¿™æ®µä»£ç ç”Ÿæˆæ–‡æ¡£: ${args}` : 'ä¸ºå½“å‰ä»£ç ç”Ÿæˆæ–‡æ¡£æ³¨é‡Š',
    ':test': (args) => args ? `ä¸ºè¿™ä¸ªå‡½æ•°ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹: ${args}` : 'ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹çš„å»ºè®®',
    ':refactor': 'åˆ†æžå½“å‰ä»£ç ï¼Œç»™å‡ºé‡æž„å»ºè®®',
    ':perf': 'ç»™å‡ºæ€§èƒ½ä¼˜åŒ–å»ºè®®',

    // å­¦ä¹ ç±»
    ':learn': (args) => args ? `æ•™æˆ‘å­¦ä¹ : ${args}` : 'æˆ‘æƒ³å­¦ä¹ æ–°çŸ¥è¯†ï¼Œç»™æˆ‘å»ºè®®',
    ':book': (args) => args ? `æŽ¨èå…³äºŽ ${args} çš„æŠ€æœ¯ä¹¦ç±` : 'æŽ¨èä¼˜ç§€çš„æŠ€æœ¯ä¹¦ç±',
    ':course': (args) => args ? `æŽ¨èå­¦ä¹  ${args} çš„åœ¨çº¿è¯¾ç¨‹æˆ–èµ„æº` : 'æŽ¨èä¼˜è´¨çš„ç¼–ç¨‹å­¦ä¹ èµ„æº',

    // ç³»ç»Ÿç›¸å…³
    ':fix': 'å¸®æˆ‘ä¿®å¤æœ€è¿‘é‡åˆ°çš„é”™è¯¯',
    ':clean': 'ç»™æˆ‘æ¸…ç†ç³»ç»Ÿæˆ–é¡¹ç›®çš„å»ºè®®',
    ':setup': (args) => args ? `å¦‚ä½•å®‰è£…å’Œé…ç½® ${args}` : 'ç»™æˆ‘å¼€å‘çŽ¯å¢ƒé…ç½®å»ºè®®',

    // åˆ›æ„ç±»
    ':name': (args) => args ? `ä¸º ${args} èµ·ä¸€ä¸ªå¥½å¬çš„åå­—` : 'å¸®æˆ‘èµ·ä¸€ä¸ªé¡¹ç›®åç§°',
    ':idea': 'ç»™æˆ‘ä¸€ä¸ªæœ‰è¶£çš„é¡¹ç›®æƒ³æ³•',
    ':color': 'æŽ¨èä¸€å¥—å¥½çœ‹çš„é…è‰²æ–¹æ¡ˆ',

    // å¸®åŠ©
    ':help': 'åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„å†…ç½®å‘½ä»¤åŠå…¶è¯´æ˜Ž',
    ':list': 'åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„å†…ç½®å‘½ä»¤'
  }

  /**
   * æ£€æŸ¥æ˜¯å¦æ˜¯å†…ç½®å‘½ä»¤
   */
  const isBuiltinCommand = (input) => {
    if (!input || typeof input !== 'string') return false
    const command = input.trim().split(/\s+/)[0]
    // æ”¯æŒå¸¦ : å‰ç¼€çš„å‘½ä»¤å’Œä¸å¸¦å‰ç¼€çš„ AI åŠ©æ‰‹åç§°
    return builtinCommands.hasOwnProperty(command)
  }

  /**
   * èŽ·å–å‘½ä»¤çš„ AI æç¤ºè¯
   */
  const getCommandPrompt = (input) => {
    const parts = input.trim().split(/\s+/)
    const command = parts[0]
    const args = parts.slice(1).join(' ')

    if (!builtinCommands.hasOwnProperty(command)) {
      return null
    }

    const template = builtinCommands[command]

    // å¦‚æžœæ˜¯å‡½æ•°ï¼Œè°ƒç”¨å‡½æ•°ç”Ÿæˆæç¤ºè¯
    if (typeof template === 'function') {
      return template(args)
    }

    // å¦åˆ™ç›´æŽ¥è¿”å›žæ¨¡æ¿
    return template
  }

  /**
   * èŽ·å–å¸®åŠ©ä¿¡æ¯
   */
  const getHelpMessage = () => {
    const categories = {
      'AI åŠ©æ‰‹': ['claude', 'kimi', 'gpt', 'deepseek'],
      'å¨±ä¹ç±»': [':joke', ':smile', ':quote', ':zen'],
      'å®žç”¨ç±»': [':tip', ':debug', ':explain', ':how'],
      'Git ç›¸å…³': [':commit', ':review', ':branch'],
      'å¼€å‘ç›¸å…³': [':doc', ':test', ':refactor', ':perf'],
      'å­¦ä¹ ç±»': [':learn', ':book', ':course'],
      'ç³»ç»Ÿç›¸å…³': [':fix', ':clean', ':setup'],
      'åˆ›æ„ç±»': [':name', ':idea', ':color'],
      'å¸®åŠ©': [':help', ':list']
    }

    let help = '\nå†…ç½®å‘½ä»¤åˆ—è¡¨:\n\n'

    for (const [category, commands] of Object.entries(categories)) {
      help += `${category}:\n`
      for (const cmd of commands) {
        const template = builtinCommands[cmd]
        let description
        if (typeof template === 'function') {
          description = template('').replace(/: $/, '')
        } else {
          // å¯¹äºŽ AI åŠ©æ‰‹ï¼Œåªæ˜¾ç¤ºç¬¬ä¸€è¡Œï¼ˆç®€çŸ­ä»‹ç»ï¼‰
          description = template.split('\n')[0]
        }
        help += `  ${cmd.padEnd(12)} - ${description}\n`
      }
      help += '\n'
    }

    help += 'ä½¿ç”¨æ–¹æ³•: ç›´æŽ¥è¾“å…¥å‘½ä»¤ï¼Œä¾‹å¦‚ :joke\n'
    help += 'å¸¦å‚æ•°å‘½ä»¤: :explain ls -la\n'

    return help
  }

  /**
   * èŽ·å–æ‰€æœ‰å‘½ä»¤åˆ—è¡¨
   */
  const getAllCommands = () => {
    return Object.keys(builtinCommands)
  }

  return {
    builtinCommands,
    isBuiltinCommand,
    getCommandPrompt,
    getHelpMessage,
    getAllCommands
  }
}
