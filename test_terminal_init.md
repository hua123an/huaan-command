# 终端初始化改进测试指南

## 改进内容

### 1. 增强的重试机制
- 最多重试 3 次，每次延迟递增（1s, 1.5s, 2s, 3s）
- 失败后显示友好的错误提示
- 避免无限重试循环

### 2. 持久化的初始化状态
- 在 store 中保存会话的初始化状态
- 页面刷新后能正确恢复状态
- 避免重复初始化

### 3. 手动初始化功能
- Ctrl+I 快捷键手动初始化
- UI 按钮手动初始化
- 适用于自动初始化失败的情况

### 4. 改进的错误处理
- 更详细的错误日志
- Shell 存在性检查
- 友好的用户提示

## 测试步骤

### 测试自动初始化
1. 创建新终端会话
2. 观察是否自动显示 shell prompt
3. 检查控制台日志中的初始化尝试信息

### 测试重试机制
1. 模拟网络延迟或资源紧张
2. 观察是否按预期重试
3. 验证失败后的错误提示

### 测试手动初始化
1. 创建新会话后按 Ctrl+I
2. 点击 UI 中的重新初始化按钮
3. 验证手动初始化是否成功

### 测试状态持久化
1. 创建会话并初始化
2. 刷新页面
3. 验证初始化状态正确恢复

## 期望结果

- ✅ 新会话能自动初始化并显示 shell prompt
- ✅ 失败时有清晰的错误提示和重试机制
- ✅ 手动初始化功能正常工作
- ✅ 页面刷新后状态正确保持
- ✅ 控制台有详细的调试信息

## 故障排除

如果仍然遇到初始化问题：

1. 检查控制台错误日志
2. 尝试手动初始化（Ctrl+I 或点击按钮）
3. 检查系统是否安装了有效的 shell
4. 查看 Rust 后端日志（如果有）